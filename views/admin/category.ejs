<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<head>
    <meta charset="utf-8">
    <title>SPORTS FIT</title>

    <meta name="author" content="themesflat.com">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="/app/css/app.css">
    <link rel="stylesheet" href="/app/css/map.min.css">

    <%-include('../layouts/admin/favicon.ejs')%>

</head>

<body class="body header-fixed ">

    <div class="preload preload-container">
        <svg class="pl" width="240" height="240" viewBox="0 0 240 240">
            <circle class="pl__ring pl__ring--a" cx="120" cy="120" r="105" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 660" stroke-dashoffset="-330" stroke-linecap="round"></circle>
            <circle class="pl__ring pl__ring--b" cx="120" cy="120" r="35" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 220" stroke-dashoffset="-110" stroke-linecap="round"></circle>
            <circle class="pl__ring pl__ring--c" cx="85" cy="120" r="70" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 440" stroke-linecap="round"></circle>
            <circle class="pl__ring pl__ring--d" cx="155" cy="120" r="70" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 440" stroke-linecap="round"></circle>
        </svg>
    </div>

    <!-- /preload -->

    <div id="wrapper">

        <div id="pagee" class="clearfix">

            <%-include('../layouts/admin/sideheader.ejs')%>
            
                <!-- End Main Header -->
<main id="main">
  <section class="profile-dashboard">
    <div class="inner-header mb-40">
      <h3 class="title">Add Category</h3>
      <p class="des">Fill out details for category hierarchy.</p>
    </div>

    <form id="form-add-category" class="form-add-program" method="POST">
      <div class="widget-dash-board pr-256 mb-75">
        <h4 class="title-add-program mb-30">1. Category Information</h4>

        <div class="input-wrap mb-30">
          <label>Main Category</label>
          <input type="text" name="categoryname" placeholder="Main Category Name" required />
        </div>

        <div class="input-wrap mb-30">
          <label>Subcategories</label>
          <div id="subcategories-container">
            <div class="subcategory-input mb-2">
              <input type="text" name="subcategories[][name]" placeholder="Subcategory (e.g. Mobiles)" />
              <button type="button" class="add-child-btn" style="background:#eb2444;">+ Child</button>
              <div class="child-container"></div>
              <button type="button" class="remove-subcategory-btn" style="background:#eb2444;">–</button>
            </div>
          </div>
          <button type="button" class="add-subcategory-btn" style="background:#eb2444; margin-top:1rem;">+ Add Subcategory</button>
        </div>
      </div>

      <div class="input-wrap">
        <button style="background:#eb2444;" type="submit" class="button-add">Save Category</button>
      </div>
    </form>
  </section>
</main>


                <%-include('../layouts/admin/footer.ejs')%>
                <!-- Bottom -->
            </div>

        </div>
        <!-- /#page -->
    </div>

    <!-- Modal Popup Bid -->

    <a id="scroll-top" class="button-go"></a>

   

    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasRightLabel">Offcanvas right</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            ...
        </div>
    </div>

    <!-- Javascript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/app/js/jquery.min.js"></script>
    <script src="/app/js/jquery.nice-select.min.js"></script>
    <script src="/app/js/bootstrap.min.js"></script>
    <script src="/app/js/tinymce/tinymce.min.js"></script>
    <script src="/app/js/tinymce/tinymce-custom.js"></script>
    <script src="/app/js/swiper-bundle.min.js"></script>
    <script src="/app/js/swiper.js"></script>
    <script src="/app/js/plugin.js"></script>
    <script src="/app/js/map.min.js"></script>
    <script src="/app/js/map.js"></script>
    <script src="/app/js/shortcodes.js"></script>
    <script src="/app/js/main.js"></script>
<script>
  const subcategoriesContainer = document.getElementById("subcategories-container");

  document.addEventListener("click", function (e) {
    // Add Subcategory
    if (e.target.classList.contains("add-subcategory-btn")) {
      const newSub = document.createElement("div");
      newSub.classList.add("subcategory-input", "mb-2");
      newSub.innerHTML = `
        <input type="text" name="subcategories[][name]" placeholder="Subcategory (e.g. Laptops)" />
        <button type="button" class="add-child-btn" style="background:#eb2444;">+ Child</button>
        <div class="child-container"></div>
        <button type="button" class="remove-subcategory-btn" style="background:#eb2444;">–</button>
      `;
      subcategoriesContainer.appendChild(newSub);
    }

    // Remove Subcategory
    if (e.target.classList.contains("remove-subcategory-btn")) {
      e.target.parentElement.remove();
    }

    // Add Child Subcategory
    if (e.target.classList.contains("add-child-btn")) {
      const childContainer = e.target.nextElementSibling;
      const childInput = document.createElement("div");
      childInput.classList.add("child-input", "mb-1");
      childInput.innerHTML = `
        <input type="text" name="children" placeholder="Child Subcategory (e.g. Android Phones)" />
        <button type="button" class="remove-child-btn" style="background:#eb2444;">–</button>
      `;
      childContainer.appendChild(childInput);
    }

    // Remove Child Subcategory
    if (e.target.classList.contains("remove-child-btn")) {
      e.target.parentElement.remove();
    }
  });

  // Handle form submission
  document.getElementById("form-add-category").addEventListener("submit", async (event) => {
    event.preventDefault();
    const form = event.target;

    const categoryname = form.querySelector("input[name='categoryname']").value.trim();
    const subcategories = [];

    form.querySelectorAll(".subcategory-input").forEach(subDiv => {
      const subName = subDiv.querySelector("input[name='subcategories[][name]']").value.trim();
      if (!subName) return;

      const children = [];
      subDiv.querySelectorAll(".child-input input").forEach(c => {
        if (c.value.trim()) children.push(c.value.trim());
      });

      subcategories.push({ name: subName, children });
    });

    const payload = { categoryname, subcategories };

    try {
      const response = await fetch("/admin/category", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const result = await response.json();

      if (response.ok) {
        Swal.fire({ icon: "success", title: "Category Added!", text: result.message })
          .then(() => window.location.reload());
      } else {
        Swal.fire({ icon: "error", title: "Failed!", text: result.message || "Something went wrong." });
      }
    } catch (err) {
      Swal.fire({ icon: "error", title: "Error!", text: "Something went wrong while saving." });
    }
  });
</script>



            
        



</body>

</html>